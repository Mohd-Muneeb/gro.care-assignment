import { type NextPage } from "next";
import Head from "next/head";
// import Link from "next/link";
import Cards from "~/components/Cards";
import type { Post, Response } from "~/types/types";
import { updateVideos } from "~/features/videoSlice";
import { useAppDispatch, useAppSelector } from "~/hooks";
import Navbar from "~/components/Navbar";
import Footer from "~/components/Footer";

const Home: NextPage<Response> = ({ data }) => {
    const videoPosts = useAppSelector((state) => state.video);
    const dispatch = useAppDispatch();

    // console.log(videoPosts);

    dispatch(updateVideos(data.data.posts));

    return (
        <>
            <Head>
                <title>Create T3 App</title>
                <meta name="description" content="Generated by create-t3-app" />
                <link rel="icon" href="/favicon.ico" />
            </Head>

            <main className="w-[95vw] md:ml-[2.5vw]">
                <div className=" mt-4 flex flex-col items-center justify-center gap-8  md:flex-row md:flex-wrap">
                    {data.message !== "Success" ? (
                        <>Something went wrong with server</>
                    ) : (
                        data.data.posts.map((post: Post) => {
                            return (
                                <>
                                    <Cards post={post} key={post.postId} />
                                </>
                            );
                        })
                    )}
                </div>
            </main>
            <Footer />
        </>
    );
};

export async function getServerSideProps() {
    const data: Response = await fetch(
        "https://internship-service.onrender.com/videos?page=2"
    )
        .then((res) => {
            if (!res.ok) {
                throw new Error(res.statusText);
            }
            return res.json();
        })
        .then((res: Response) => {
            return res;
        });

    return {
        props: { data },
    };
}

export default Home;
